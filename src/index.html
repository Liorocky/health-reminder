<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HealthFlow | Smart Work-Life Balance</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#f0f9ff',
                            100: '#e0f2fe',
                            200: '#bae6fd',
                            300: '#7dd3fc',
                            400: '#38bdf8',
                            500: '#0ea5e9',
                            600: '#0284c7',
                            700: '#0369a1',
                            800: '#075985',
                            900: '#0c4a6e',
                        }
                    },
                    animation: {
                        'ping-slow': 'ping 2s cubic-bezier(0, 0, 0.2, 1) infinite',
                        'bounce-slow': 'bounce 3s infinite'
                    }
                }
            }
        }
    </script>
    <style>
        @keyframes gradientWave {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .gradient-bg {
            background: linear-gradient(-45deg, #0ea5e9, #6366f1, #ec4899, #f59e0b);
            background-size: 400% 400%;
            animation: gradientWave 15s ease infinite;
        }
        
        .timer-ring {
            stroke-dasharray: 283;
            stroke-dashoffset: 283;
            transition: stroke-dashoffset 0.1s linear;
        }

        [data-tooltip] {
            position: relative;
            cursor: pointer;
        }
        
        [data-tooltip]:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: calc(100% + 5px);
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.9);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            white-space: nowrap;
            pointer-events: none;
            z-index: 50;
            min-width: 100px;
            text-align: center;
        }
        
        .modal-enter {
            opacity: 0;
            transform: scale(0.95);
        }
        .modal-enter-active {
            opacity: 1;
            transform: scale(1);
            transition: opacity 200ms, transform 200ms;
        }
        .modal-exit {
            opacity: 1;
        }
        .modal-exit-active {
            opacity: 0;
            transform: scale(0.95);
            transition: opacity 200ms, transform 200ms;
        }
        
        .switch {
            position: relative;
            display: inline-block;
            width: 52px;
            height: 28px;
        }
        
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: #0ea5e9;
        }
        
        input:checked + .slider:before {
            transform: translateX(24px);
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100 min-h-screen transition-colors duration-300">
    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <!-- Header -->
        <header class="flex justify-between items-center mb-8">
            <div class="flex items-center space-x-2">
                <div class="gradient-bg w-10 h-10 rounded-lg flex items-center justify-center text-white">
                    <i class="fas fa-heartbeat text-xl"></i>
                </div>
                <h1 class="text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-blue-500 to-purple-600">HealthFlow</h1>
            </div>
            <button id="themeToggle" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">
                <i class="fas fa-moon dark:hidden"></i>
                <i class="fas fa-sun hidden dark:inline"></i>
            </button>
        </header>
        
        <!-- Main Content -->
        <main>
            <!-- Start Button -->
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 mb-8 transition-all hover:shadow-xl">
                <h2 class="text-xl font-semibold mb-4">Work Session</h2>
                <div class="flex space-x-2">
                    <button id="startWorkBtn" class="flex-1 py-3 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-medium transition-colors flex items-center justify-center">
                        <i class="fas fa-play mr-2"></i> <span id="startBtnText">Start Working</span>
                    </button>
                    <button id="stopWorkBtn" class="hidden px-4 py-3 bg-red-500 hover:bg-red-600 text-white rounded-lg font-medium transition-colors flex items-center justify-center">
                        <i class="fas fa-stop"></i>
                    </button>
                </div>
            </div>
            
            <!-- Timer Display -->
            <div id="timerSection" class="hidden bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 mb-8 transition-all">
                <div class="flex flex-col items-center">
                    <div class="relative w-64 h-64 mb-6">
                        <svg class="w-full h-full" viewBox="0 0 100 100">
                            <!-- Background track -->
                            <circle cx="50" cy="50" r="45" fill="none" stroke="#e5e7eb" stroke-width="8" stroke-opacity="0.3" class="dark:stroke-gray-700"/>
                            
                            <!-- Progress track -->
                            <circle id="timerRing" cx="50" cy="50" r="45" fill="none" stroke="#0ea5e9" stroke-width="8" stroke-linecap="round" transform="rotate(-90 50 50)" class="timer-ring"/>
                            
                            <!-- Phase markers with tooltips -->
                            <g id="markersGroup">
                                <circle id="waterMarker" cx="50" cy="5" r="4" fill="#3b82f6" stroke="white" stroke-width="1.5" 
                                    class="hover:r-5 transition-all cursor-pointer" 
                                    data-tooltip="Drink Water" style="pointer-events: all;"/>
                                <circle id="moveMarker" cx="50" cy="5" r="4" fill="#10b981" stroke="white" stroke-width="1.5" 
                                    class="hover:r-5 transition-all cursor-pointer" 
                                    data-tooltip="Move Around" style="pointer-events: all;"/>
                                <circle id="eyeMarker" cx="50" cy="5" r="4" fill="#f59e0b" stroke="white" stroke-width="1.5" 
                                    class="hover:r-5 transition-all cursor-pointer" 
                                    data-tooltip="Rest Eyes" style="pointer-events: all;"/>
                            </g>
                            
                            <!-- Moving dot -->
                            <circle id="progressDot" cx="50" cy="5" r="4" fill="#0ea5e9" class="transition-transform duration-1000 ease-linear" transform="rotate(0 50 50)"/>
                        </svg>
                        <div class="absolute inset-0 flex flex-col items-center justify-center">
                            <span id="timerDisplay" class="text-4xl font-bold">25:00</span>
                            <span id="timerLabel" class="text-gray-500 dark:text-gray-400">Next: Drink Water in</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Health Reminders -->
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 mb-8 transition-all hover:shadow-xl">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-semibold">Health Reminders</h2>
                    <button id="configureBtn" class="text-sm text-blue-500 hover:text-blue-700 dark:hover:text-blue-400 font-medium flex items-center">
                        <i class="fas fa-cog mr-1"></i> Configure
                    </button>
                </div>
                
                <div class="space-y-4">
                    <div class="flex items-center justify-between p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg">
                        <div class="flex items-center">
                            <div class="w-10 h-10 rounded-full bg-blue-100 dark:bg-blue-900 flex items-center justify-center mr-3">
                                <i class="fas fa-tint text-blue-500"></i>
                            </div>
                            <div>
                                <h3 class="font-medium">Hydration</h3>
                                <p class="text-sm text-gray-500 dark:text-gray-400">Every <span id="waterInterval">120</span> minutes</p>
                            </div>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="waterToggle" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                    
                    <div class="flex items-center justify-between p-3 bg-green-50 dark:bg-green-900/20 rounded-lg">
                        <div class="flex items-center">
                            <div class="w-10 h-10 rounded-full bg-green-100 dark:bg-green-900 flex items-center justify-center mr-3">
                                <i class="fas fa-running text-green-500"></i>
                            </div>
                            <div>
                                <h3 class="font-medium">Movement</h3>
                                <p class="text-sm text-gray-500 dark:text-gray-400">Every <span id="moveInterval">50</span> minutes</p>
                            </div>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="moveToggle" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                    
                    <div class="flex items-center justify-between p-3 bg-amber-50 dark:bg-amber-900/20 rounded-lg">
                        <div class="flex items-center">
                            <div class="w-10 h-10 rounded-full bg-amber-100 dark:bg-amber-900 flex items-center justify-center mr-3">
                                <i class="fas fa-eye text-amber-500"></i>
                            </div>
                            <div>
                                <h3 class="font-medium">Eye Rest</h3>
                                <p class="text-sm text-gray-500 dark:text-gray-400">Every <span id="eyeInterval">20</span> minutes</p>
                            </div>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="eyeToggle" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>
            </div>
            
            <!-- Status Bar -->
            <div id="statusBar" class="hidden fixed bottom-0 left-0 right-0 bg-blue-500 text-white p-3 shadow-lg transform translate-y-full transition-transform duration-300">
                <div class="container mx-auto flex justify-between items-center">
                    <div class="flex items-center">
                        <i class="fas fa-bell mr-2 animate-bounce-slow"></i>
                        <span id="statusMessage">Time to drink water!</span>
                    </div>
                    <button id="dismissBtn" class="bg-white/20 hover:bg-white/30 rounded-full w-8 h-8 flex items-center justify-center">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
        </main>
    </div>
    
    <!-- Configuration Modal -->
    <div id="configModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden transition-opacity duration-200 opacity-0">
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-xl w-full max-w-md transform transition-all duration-200 scale-95 opacity-0">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-semibold">Reminder Settings</h3>
                    <button id="closeModalBtn" class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div class="space-y-6">
                    <div>
                        <div class="flex justify-between items-center mb-2">
                            <label for="waterConfig" class="font-medium flex items-center">
                                <i class="fas fa-tint text-blue-500 mr-2"></i> Hydration
                            </label>
                            <label class="switch">
                                <input type="checkbox" id="waterConfigToggle" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div class="flex items-center">
                            <input type="range" id="waterConfig" min="30" max="240" step="10" value="120" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer dark:bg-gray-700">
                            <span id="waterConfigValue" class="ml-3 w-12 text-center">120</span>
                            <span class="ml-1 text-gray-500">min</span>
                        </div>
                    </div>
                    
                    <div>
                        <div class="flex justify-between items-center mb-2">
                            <label for="moveConfig" class="font-medium flex items-center">
                                <i class="fas fa-running text-green-500 mr-2"></i> Movement
                            </label>
                            <label class="switch">
                                <input type="checkbox" id="moveConfigToggle" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div class="flex items-center">
                            <input type="range" id="moveConfig" min="30" max="240" step="10" value="50" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer dark:bg-gray-700">
                            <span id="moveConfigValue" class="ml-3 w-12 text-center">50</span>
                            <span class="ml-1 text-gray-500">min</span>
                        </div>
                    </div>
                    
                    <div>
                        <div class="flex justify-between items-center mb-2">
                            <label for="eyeConfig" class="font-medium flex items-center">
                                <i class="fas fa-eye text-amber-500 mr-2"></i> Eye Rest
                            </label>
                            <label class="switch">
                                <input type="checkbox" id="eyeConfigToggle" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div class="flex items-center">
                            <input type="range" id="eyeConfig" min="10" max="120" step="5" value="20" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer dark:bg-gray-700">
                            <span id="eyeConfigValue" class="ml-3 w-12 text-center">20</span>
                            <span class="ml-1 text-gray-500">min</span>
                        </div>
                    </div>
                </div>
                
                <div class="mt-6 flex justify-end space-x-3">
                    <button id="cancelConfigBtn" class="px-4 py-2 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 rounded-lg font-medium transition-colors">
                        Cancel
                    </button>
                    <button id="saveConfigBtn" class="px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-medium transition-colors">
                        Save Changes
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Custom Timer Modal -->
    <div id="customModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 opacity-0 pointer-events-none transition-opacity duration-200">
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-xl w-full max-w-md transform scale-95 transition-transform">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-semibold">Custom Timer</h3>
                    <button id="closeCustomModalBtn" class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div class="space-y-4">
                    <div>
                        <label for="customMinutes" class="block mb-2 font-medium">Minutes</label>
                        <input type="number" id="customMinutes" min="1" max="240" value="25" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700">
                    </div>
                    
                    <div>
                        <label for="customLabel" class="block mb-2 font-medium">Label (optional)</label>
                        <input type="text" id="customLabel" placeholder="e.g. Study Session" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700">
                    </div>
                </div>
                
                <div class="mt-6 flex justify-end space-x-3">
                    <button id="cancelCustomBtn" class="px-4 py-2 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 rounded-lg font-medium transition-colors">
                        Cancel
                    </button>
                    <button id="saveCustomBtn" class="px-4 py-2 bg-purple-500 hover:bg-purple-600 text-white rounded-lg font-medium transition-colors">
                        Start Timer
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // DOM Elements
        const themeToggle = document.getElementById('themeToggle');
        const timerSection = document.getElementById('timerSection');
        const timerDisplay = document.getElementById('timerDisplay');
        const timerLabel = document.getElementById('timerLabel');
        const timerRing = document.getElementById('timerRing');
        const startStopBtn = document.getElementById('startStopBtn');
        const resetBtn = document.getElementById('resetBtn');
        const statusBar = document.getElementById('statusBar');
        const statusMessage = document.getElementById('statusMessage');
        const dismissBtn = document.getElementById('dismissBtn');
        const configureBtn = document.getElementById('configureBtn');
        const configModal = document.getElementById('configModal');
        const closeModalBtn = document.getElementById('closeModalBtn');
        const cancelConfigBtn = document.getElementById('cancelConfigBtn');
        const saveConfigBtn = document.getElementById('saveConfigBtn');
        const customModal = document.getElementById('customModal');
        const closeCustomModalBtn = document.getElementById('closeCustomModalBtn');
        const cancelCustomBtn = document.getElementById('cancelCustomBtn');
        const saveCustomBtn = document.getElementById('saveCustomBtn');
        const modeBtns = document.querySelectorAll('.mode-btn');
        
        // Reminder toggles and intervals
        const waterToggle = document.getElementById('waterToggle');
        const moveToggle = document.getElementById('moveToggle');
        const eyeToggle = document.getElementById('eyeToggle');
        const waterInterval = document.getElementById('waterInterval');
        const moveInterval = document.getElementById('moveInterval');
        const eyeInterval = document.getElementById('eyeInterval');
        
        // Configuration inputs
        const waterConfigToggle = document.getElementById('waterConfigToggle');
        const moveConfigToggle = document.getElementById('moveConfigToggle');
        const eyeConfigToggle = document.getElementById('eyeConfigToggle');
        const waterConfig = document.getElementById('waterConfig');
        const moveConfig = document.getElementById('moveConfig');
        const eyeConfig = document.getElementById('eyeConfig');
        const waterConfigValue = document.getElementById('waterConfigValue');
        const moveConfigValue = document.getElementById('moveConfigValue');
        const eyeConfigValue = document.getElementById('eyeConfigValue');
        
        // Custom timer inputs
        const customMinutes = document.getElementById('customMinutes');
        const customLabel = document.getElementById('customLabel');
        
        // Timer variables
        let timer;
        let timeLeft = 0;
        let totalTime = 50 * 60; // Default 50 minute work session
        let phaseMarkers = [];
        let nextPhaseIndex = 0;
        
        // Reminder variables
        let waterTime = 120 * 60;
        let moveTime = 50 * 60;
        let eyeTime = 20 * 60;
        let waterEnabled = true;
        let moveEnabled = true;
        let eyeEnabled = true;
        
        // Notification sound
        const notificationSound = new Audio('https://assets.mixkit.co/sfx/preview/mixkit-alarm-digital-clock-beep-989.mp3');
        
        // Theme toggle
        themeToggle.addEventListener('click', () => {
            document.documentElement.classList.toggle('dark');
            localStorage.setItem('theme', document.documentElement.classList.contains('dark') ? 'dark' : 'light');
        });
        
        // Check for saved theme preference
        if (localStorage.getItem('theme') === 'dark' || (!localStorage.getItem('theme') && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
        } else {
            document.documentElement.classList.remove('dark');
        }
        
        // Start work button
        document.getElementById('startWorkBtn').addEventListener('click', () => {
            startTimer(totalTime, 'Work Session');
            calculatePhaseMarkers();
            document.getElementById('stopWorkBtn').classList.remove('hidden');
        });

        // Stop work button
        document.getElementById('stopWorkBtn').addEventListener('click', () => {
            stopTimer();
            document.getElementById('stopWorkBtn').classList.add('hidden');
            document.getElementById('startBtnText').textContent = 'Start Working';
        });
        
        // Start/stop timer
        startStopBtn.addEventListener('click', () => {
            if (isRunning) {
                stopTimer();
            } else {
                startTimer(timeLeft, timerLabel.textContent);
            }
        });
        
        // Reset timer
        resetBtn.addEventListener('click', () => {
            clearInterval(timer);
            timeLeft = totalTime;
            nextPhaseIndex = 0;
            updateNextPhaseLabel();
            updateTimerDisplay();
            updateRing();
            timer = setInterval(updateTimer, 1000);
        });
        
        // Show configuration modal
        configureBtn.addEventListener('click', () => {
            // Set current values in modal
            waterConfigToggle.checked = waterEnabled;
            moveConfigToggle.checked = moveEnabled;
            eyeConfigToggle.checked = eyeEnabled;
            waterConfig.value = waterTime / 60;
            moveConfig.value = moveTime / 60;
            eyeConfig.value = eyeTime / 60;
            waterConfigValue.textContent = waterTime / 60;
            moveConfigValue.textContent = moveTime / 60;
            eyeConfigValue.textContent = eyeTime / 60;
            
            showModal(configModal);
        });
        
        // Close modals
        closeModalBtn.addEventListener('click', () => hideModal(configModal));
        cancelConfigBtn.addEventListener('click', () => hideModal(configModal));
        closeCustomModalBtn.addEventListener('click', () => hideModal(customModal));
        cancelCustomBtn.addEventListener('click', () => hideModal(customModal));
        
        // Save configuration
        saveConfigBtn.addEventListener('click', () => {
            waterEnabled = waterConfigToggle.checked;
            moveEnabled = moveConfigToggle.checked;
            eyeEnabled = eyeConfigToggle.checked;
            waterTime = waterConfig.value * 60;
            moveTime = moveConfig.value * 60;
            eyeTime = eyeConfig.value * 60;
            
            // Update UI
            waterToggle.checked = waterEnabled;
            moveToggle.checked = moveEnabled;
            eyeToggle.checked = eyeEnabled;
            waterInterval.textContent = waterTime / 60;
            moveInterval.textContent = moveTime / 60;
            eyeInterval.textContent = eyeTime / 60;
            
            // Save to localStorage
            saveSettings();
            
            hideModal(configModal);
        });
        
        // Save custom timer
        saveCustomBtn.addEventListener('click', () => {
            const minutes = parseInt(customMinutes.value);
            if (minutes < 1 || minutes > 240) {
                alert('Please enter a value between 1 and 240 minutes');
                return;
            }
            
            const label = customLabel.value || 'Custom Timer';
            startTimer(minutes * 60, label);
            hideModal(customModal);
        });
        
        // Dismiss notification
        dismissBtn.addEventListener('click', () => {
            statusBar.classList.add('translate-y-full');
        });
        
        // Update range value displays
        waterConfig.addEventListener('input', () => {
            waterConfigValue.textContent = waterConfig.value;
        });
        
        moveConfig.addEventListener('input', () => {
            moveConfigValue.textContent = moveConfig.value;
        });
        
        eyeConfig.addEventListener('input', () => {
            eyeConfigValue.textContent = eyeConfig.value;
        });
        
        // Timer functions
        function startTimer(seconds, label) {
            // Clear any existing timer
            clearInterval(timer);
            
            // Set up new timer
            totalTime = seconds;
            timeLeft = seconds;
            nextPhaseIndex = 0;
            
            calculatePhaseMarkers();
            updateNextPhaseLabel();
            // Show time until first phase or total time if no phases
            const initialTimeToShow = phaseMarkers.length > 0 ? phaseMarkers[0].time : totalTime;
            updateTimerDisplay(initialTimeToShow);
            updateRing();
            
            // Update button text
            document.getElementById('startBtnText').textContent = 'Restart';
            
            // Start the timer
            timer = setInterval(updateTimer, 1000);
            
            // Show timer section if hidden
            timerSection.classList.remove('hidden');
        }

        function stopTimer() {
            clearInterval(timer);
            document.getElementById('stopWorkBtn').classList.add('hidden');
            document.getElementById('startBtnText').textContent = 'Start Working';
        }
        
        function updateTimer() {
            timeLeft--;
            
            // Calculate time until next phase
            const elapsed = totalTime - timeLeft;
            let nextPhaseTime = phaseMarkers[nextPhaseIndex]?.time || totalTime;
            let timeUntilNextPhase = nextPhaseTime - elapsed;
            
            // Update display with time until next phase
            updateTimerDisplay(timeUntilNextPhase > 0 ? timeUntilNextPhase : timeLeft);
            updateRing();
            
            // Check for phase changes
            checkPhases();
            
            if (timeLeft <= 0) {
                stopTimer();
                showNotification('Work session completed! Take a break!');
                notificationSound.play();
            }
        }
        
        function updateTimerDisplay(timeToShow = timeLeft) {
            const minutes = Math.floor(timeToShow / 60);
            const seconds = timeToShow % 60;
            timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }
        
        function updateRing() {
            const circumference = 283;
            const offset = circumference - (timeLeft / totalTime) * circumference;
            timerRing.style.strokeDashoffset = offset;
            
            // Update progress dot position
            const progress = 1 - (timeLeft / totalTime);
            const angle = progress * 360;
            document.getElementById('progressDot').setAttribute('transform', `rotate(${angle} 50 50)`);
        }

        function calculatePhaseMarkers() {
            // Clear previous markers
            phaseMarkers = [];
            document.getElementById('waterMarker').classList.remove('hidden');
            document.getElementById('moveMarker').classList.remove('hidden');
            document.getElementById('eyeMarker').classList.remove('hidden');

            if (waterEnabled) {
                const waterAngle = (waterTime / totalTime) * 360;
                phaseMarkers.push({time: waterTime, angle: waterAngle, element: 'waterMarker', type: 'water'});
            }
            if (moveEnabled) {
                const moveAngle = (moveTime / totalTime) * 360;
                phaseMarkers.push({time: moveTime, angle: moveAngle, element: 'moveMarker', type: 'move'});
            }
            if (eyeEnabled) {
                const eyeAngle = (eyeTime / totalTime) * 360;
                phaseMarkers.push({time: eyeTime, angle: eyeAngle, element: 'eyeMarker', type: 'eye'});
            }

            // Sort by time and update marker positions
            phaseMarkers.sort((a, b) => a.time - b.time);
            phaseMarkers.forEach(marker => {
                const element = document.getElementById(marker.element);
                element.setAttribute('transform', `rotate(${marker.angle} 50 50)`);
                element.classList.remove('hidden');
            });
        }

        function updateNextPhaseLabel() {
            if (phaseMarkers.length === 0) {
                timerLabel.textContent = "Working...";
                return;
            }

            if (nextPhaseIndex >= phaseMarkers.length) {
                timerLabel.textContent = "Session Complete!";
                return;
            }

            const nextPhase = phaseMarkers[nextPhaseIndex];
            let label = "";
            switch(nextPhase.type) {
                case 'water':
                    label = "Next: Drink Water in";
                    break;
                case 'move':
                    label = "Next: Move Around in";
                    break;
                case 'eye':
                    label = "Next: Rest Eyes in";
                    break;
            }
            timerLabel.textContent = label;
        }

        function checkPhases() {
            const elapsed = totalTime - timeLeft;
            
            if (nextPhaseIndex < phaseMarkers.length && elapsed >= phaseMarkers[nextPhaseIndex].time) {
                triggerPhaseNotification(phaseMarkers[nextPhaseIndex].type);
                nextPhaseIndex++;
                updateNextPhaseLabel();
            }
        }

        function triggerPhaseNotification(type) {
            let message = '';
            let markerId = '';
            
            switch(type) {
                case 'water':
                    message = 'Time to drink some water! ðŸ’§';
                    markerId = 'waterMarker';
                    break;
                case 'move':
                    message = 'Time to stand up and move! ðŸƒâ€â™‚ï¸';
                    markerId = 'moveMarker';
                    break;
                case 'eye':
                    message = 'Give your eyes a 20-second break! ðŸ‘€';
                    markerId = 'eyeMarker';
                    break;
            }
            
            // Animate the marker
            const marker = document.getElementById(markerId);
            marker.classList.add('animate-ping');
            setTimeout(() => {
                marker.classList.remove('animate-ping');
            }, 1000);
            
            showNotification(message);
            notificationSound.play();
        }
        
        // Reminder functions
        function checkReminders() {
            if (!isRunning) return;
            
            const elapsed = totalTime - timeLeft;
            
            if (waterEnabled && elapsed > 0 && elapsed % waterTime === 0) {
                showNotification('Time to drink some water! ðŸ’§');
                notificationSound.play();
            }
            
            if (moveEnabled && elapsed > 0 && elapsed % moveTime === 0) {
                showNotification('Time to stand up and move! ðŸƒâ€â™‚ï¸');
                notificationSound.play();
            }
            
            if (eyeEnabled && elapsed > 0 && elapsed % eyeTime === 0) {
                showNotification('Give your eyes a 20-second break! ðŸ‘€');
                notificationSound.play();
            }
        }
        
        function showNotification(message) {
            statusMessage.textContent = message;
            statusBar.classList.remove('hidden', 'translate-y-full');
            statusBar.classList.add('translate-y-0');
            
            // Auto-hide after 10 seconds
            setTimeout(() => {
                statusBar.classList.add('translate-y-full');
            }, 10000);
        }
        
        // Modal functions
        function showModal(modal) {
            modal.classList.remove('hidden');
            setTimeout(() => {
                modal.style.opacity = '1';
                modal.querySelector('div').classList.remove('opacity-0', 'scale-95');
                modal.querySelector('div').classList.add('opacity-100', 'scale-100');
            }, 10);
        }
        
        function hideModal(modal) {
            modal.querySelector('div').classList.remove('scale-100', 'opacity-100');
            modal.querySelector('div').classList.add('scale-95', 'opacity-0');
            setTimeout(() => {
                modal.style.opacity = '0';
                modal.classList.add('hidden');
            }, 200);
        }
        
        function showCustomModal() {
            customMinutes.value = '25';
            customLabel.value = '';
            showModal(customModal);
        }
        
        // Settings persistence
        function saveSettings() {
            const settings = {
                waterEnabled,
                moveEnabled,
                eyeEnabled,
                waterTime,
                moveTime,
                eyeTime
            };
            localStorage.setItem('healthFlowSettings', JSON.stringify(settings));
        }
        
        function loadSettings() {
            const savedSettings = localStorage.getItem('healthFlowSettings');
            if (savedSettings) {
                const settings = JSON.parse(savedSettings);
                waterEnabled = settings.waterEnabled;
                moveEnabled = settings.moveEnabled;
                eyeEnabled = settings.eyeEnabled;
                waterTime = settings.waterTime;
                moveTime = settings.moveTime;
                eyeTime = settings.eyeTime;
                
                // Update UI
                waterToggle.checked = waterEnabled;
                moveToggle.checked = moveEnabled;
                eyeToggle.checked = eyeEnabled;
                waterInterval.textContent = waterTime / 60;
                moveInterval.textContent = moveTime / 60;
                eyeInterval.textContent = eyeTime / 60;
            }
        }
        
        // Initialize
        loadSettings();
    </script>
</body>
</html>